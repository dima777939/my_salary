# Приложение "My salary"

REST-сервис просмотра текущей зарплаты и даты следующего повышения

## Описание функционала
Для пользования сервисом необходимо пройти регистрацию. Авторизация происходит по логину и паролю, после чего  
выдаётся токен, который действует определенное время. Доступ к другим функциям сервиса доступен только после  
предъявления валидного токена. Пользователю доступен просмотр только своих данных о размере зарплаты и даты  
следующего повышения.


   У пользователей есть три уровня доступа: пользователь, сотрудник персонала, администратор  
   * Пользователь - может просматривать свою текущую зарплату и дату следующего повышения
   * Сотрудник персонала - может просматривать список пользователей, изменять данные зарплаты любого пользователя  
и дату следующего повышения
   * Администратор - может повышать уровень доступа до сотрудника персонала или понижать его, удалять
и восстанавливать пользователя

## Основные технологии
* FastAPI
* Docker
* Docker compose
* SQLAlchemy
* Alembic
* Pytest


## Запуск проекта
Перед сборкой контейнеров необходимо переименовать файл `.env.example` в `.env`  
и заполнить отсутствующие данные в переменных. Заполнить данные для создания  
базы данных Postgresql и токена. `SECRET_KEY` сгенерировать командой ``openssl rand -hex 32``

### Для сборки и запуска контейнеров docker 


`docker-compose up -d`

### После запуска контейнера необходимо выполнить миграцию таблиц в базу данных


`docker compose exec web alembic upgrade head`

После завершения миграций сервис доступен.  

Просмотреть сгенерированную документацию http://localhost:8002/docs#/ 
### Доступно 8 роутеров:
* post("/register/") - регистрация
* post("/auth/") - авторизация
* get("/users/me/") - просмотр текущей зарплаты в час и дату повышения
* get("/users/")  - просмотр списка пользователей
* get("/users/{user_name}") - просмотр данных пользователя
* put("/users/{user_name}") - обновление зарплаты и даты повышения выбранному пользователю
* put("/users/upgrade/{user_name}") - обновление прав выбранного пользователя до сотрудника персонала
* put("/users/activation/{user_name}") - удаление и восстановление выбранного пользователя



## Тестирование

Перед тестированием необходимо переименовать базу данных в файле `.env`.   
Для этого необходимо остановить docker  `docker-compose stop`, потом переименовать в файле `.env`
имя базы данных в переменной `POSTGRES_DB` (например test_db), и запустить контейнеры `docker-compose up -d`.

Запустить тесты командой `docker-compose exec web pytest -s -v`

После прохождения тестов необходимо остановить контейнеры, переименовать обратно имя базы данных и запустить контейнеры


